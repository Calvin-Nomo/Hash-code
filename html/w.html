<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Panel - Restaurant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* ---------------- Global Styles ---------------- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      body {
        display: flex;
        height: 100vh;
        background: #f0f2f5;
        overflow: hidden;
      }

      /* ---------------- Sidebar ---------------- */
      .sidebar {
        width: 260px;
        background: linear-gradient(180deg, #007bff, #00c6ff);
        color: #fff;
        display: flex;
        flex-direction: column;
        padding-top: 20px;
        box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      .sidebar h2 {
        text-align: center;
        font-size: 1.6em;
        margin-bottom: 30px;
        font-weight: bold;
        text-shadow: 1px 1px rgba(0, 0, 0, 0.3);
      }
      .menu-btn {
        background: transparent;
        border: none;
        color: #fff;
        padding: 14px 25px;
        text-align: left;
        font-size: 1em;
        cursor: pointer;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: 0.3s;
        position: relative;
      }
      .menu-btn:hover,
      .menu-btn.active {
        background: rgba(255, 255, 255, 0.15);
      }
      .menu-btn span {
        transition: transform 0.3s ease;
      }
      .dropdown-content {
        display: none;
        flex-direction: column;
        background: rgba(255, 255, 255, 0.1);
        padding-left: 20px;
        animation: fadeIn 0.3s ease;
      }
      .dropdown-content button {
        background: transparent;
        border: none;
        color: #fff;
        text-align: left;
        padding: 10px 25px;
        cursor: pointer;
        transition: 0.2s;
        font-size: 0.95em;
      }
      .dropdown-content button:hover {
        background: rgba(255, 255, 255, 0.15);
      }
      .menu-btn.open span {
        transform: rotate(90deg);
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ---------------- Main Content ---------------- */
      .main-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f4f7fa;
      }
      .section {
        display: none;
        animation: fadeIn 0.3s ease;
      }
      .section.active {
        display: block;
      }

      /* ---------------- Dashboard Cards ---------------- */
      .dashboard-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
      }
      .card {
        flex: 1 1 250px;
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .card h3 {
        margin-bottom: 10px;
        color: #333;
      }

      /* ---------------- Tables ---------------- */
      table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #f7f7f7;
        color: #333;
      }
      table tr:hover {
        background: rgba(0, 123, 255, 0.05);
        transition: 0.3s;
      }
      table img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
      }

      /* ---------------- Forms ---------------- */
      input,
      select,
      button {
        margin: 5px;
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 0.95em;
      }
      button {
        border: none;
        background: #007bff;
        color: #fff;
        cursor: pointer;
        transition: 0.3s;
      }
      button:hover {
        background: #0056b3;
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 220px;
        }
        .card {
          flex: 1 1 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- ---------------- Sidebar ---------------- -->
    <div class="sidebar">
      <h2>Admin Panel</h2>
      <button class="menu-btn active" onclick="showSection('dashboard')">
        Dashboard
      </button>

      <button class="menu-btn" onclick="toggleDropdown(this)">
        Orders & Reservations <span>▶</span>
      </button>
      <div class="dropdown-content">
        <button onclick="showSection('order')">Orders</button>
        <button onclick="showSection('orderItems')">Order Items</button>
        <button onclick="showSection('reservation')">Reservations</button>
        <button onclick="showSection('payment')">Payments</button>
        <button onclick="showSection('newOrder')">Add Full Order</button>
      </div>

      <button class="menu-btn" onclick="toggleDropdown(this)">
        Inventory <span>▶</span>
      </button>
      <div class="dropdown-content">
        <button onclick="showSection('product')">Products</button>
        <button onclick="showSection('stock')">Stock</button>
        <button onclick="showSection('table')">Tables</button>
      </div>

      <button class="menu-btn" onclick="showSection('client')">Clients</button>
      <button class="menu-btn" onclick="showSection('system')">
        System Settings
      </button>
      <button class="menu-btn" style="background: #ff4d4f" onclick="logout()">
        Logout
      </button>
    </div>

    <!-- ---------------- Main Content ---------------- -->
    <div class="main-content">
      <!-- Dashboard -->
      <div id="dashboard" class="section active">
        <h1>Dashboard</h1>
        <div class="dashboard-cards">
          <div class="card">
            <h3>Total Orders</h3>
            <p id="total-orders">0</p>
          </div>
          <div class="card">
            <h3>Total Revenue</h3>
            <p id="total-revenue">0 FCFA</p>
          </div>
          <div class="card">
            <h3>Total Reservations</h3>
            <p id="total-reservations">0</p>
          </div>
        </div>
        <div>
          <label for="revenueFilter">Filter:</label>
          <select id="revenueFilter" onchange="updateRevenueChart()">
            <option value="day">Per Day</option>
            <option value="month">Per Month</option>
            <option value="year">Per Year</option>
          </select>
          <canvas id="revenueChart" height="150"></canvas>
        </div>
      </div>

      <!-- Other Sections -->
      <div id="client" class="section"><h1>Clients</h1></div>
      <div id="product" class="section"><h1>Products</h1></div>
      <div id="order" class="section"><h1>Orders</h1></div>
      <div id="orderItems" class="section"><h1>Order Items</h1></div>
      <div id="reservation" class="section"><h1>Reservations</h1></div>
      <div id="payment" class="section"><h1>Payments</h1></div>
      <div id="stock" class="section"><h1>Stock</h1></div>
      <div id="table" class="section"><h1>Tables</h1></div>
      <div id="system" class="section"><h1>System Settings</h1></div>

      <!-- Add Full Order Section -->
      <div id="newOrder" class="section">
        <h1>Add Full Order</h1>
        <form id="fullOrderForm">
          <h3>Client</h3>
          <input
            type="text"
            name="client_name"
            placeholder="Client Name"
            required
          />
          <input type="text" name="client_contact" placeholder="Contact" />
          <h3>Reservation</h3>
          <input type="number" name="table_id" placeholder="Table ID" />
          <input type="number" name="seat_no" placeholder="Seat Number" />
          <h3>Order</h3>
          <input
            type="number"
            name="order_id"
            placeholder="Order ID"
            required
          />
          <input
            type="text"
            name="order_type"
            placeholder="Order Type"
            required
          />
          <input type="text" name="note" placeholder="Note" />
          <h3>Payment</h3>
          <input type="number" name="total" placeholder="Total" required />
          <input
            type="text"
            name="method"
            placeholder="Payment Method"
            required
          />
          <button type="submit">Submit Full Order</button>
        </form>
        <p id="orderMessage"></p>
      </div>
    </div>

    <script>
      const API_BASE = "http://127.0.0.1:8000";
      let revenueChart;

      // ---------------- Dashboard ----------------
      async function loadDashboard() {
        await updateRevenueChart();
        // Example totals
        document.getElementById("total-orders").textContent = 120;
        document.getElementById("total-reservations").textContent = 48;
        document.getElementById("total-revenue").textContent = "1,200,000 FCFA";
      }

      async function updateRevenueChart() {
        const filter = document.getElementById("revenueFilter").value;
        try {
          const response = await fetch(
            `${API_BASE}/revenue_over_time?filter=${filter}`
          );
          const data = await response.json();
          const labels = data.map((d) => d.date);
          const revenues = data.map((d) => d.revenue);

          const ctx = document.getElementById("revenueChart").getContext("2d");
          if (revenueChart) revenueChart.destroy();
          revenueChart = new Chart(ctx, {
            type: "line",
            data: {
              labels,
              datasets: [
                {
                  label: "Revenue (FCFA)",
                  data: revenues,
                  borderColor: "#007bff",
                  backgroundColor: "rgba(0,123,255,0.2)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true },
                title: { display: true, text: `Revenue Over Time (${filter})` },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  title: { display: true, text: "Revenue (FCFA)" },
                },
                x: { title: { display: true, text: "Period" } },
              },
            },
          });
        } catch (err) {
          console.error("Error fetching revenue data:", err);
        }
      }

      // ---------------- Sidebar ----------------
      function toggleDropdown(button) {
        const content = button.nextElementSibling;
        const isOpen = button.classList.contains("open");
        document
          .querySelectorAll(".dropdown-content")
          .forEach((d) => (d.style.display = "none"));
        document
          .querySelectorAll(".menu-btn")
          .forEach((b) => b.classList.remove("open"));
        if (!isOpen) {
          content.style.display = "flex";
          button.classList.add("open");
        }
      }

      function showSection(sectionId) {
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById(sectionId).classList.add("active");
        document
          .querySelectorAll(".menu-btn")
          .forEach((b) => b.classList.remove("active"));
        event.target.classList.add("active");
      }

      function logout() {
        alert("You have been logged out successfully!");
      }

      // ---------------- Full Order Form ----------------
      document
        .getElementById("fullOrderForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const form = e.target;
          const payload = {
            client: {
              name: form.client_name.value,
              contact: form.client_contact.value,
            },
            reversation: form.table_id.value
              ? {
                  table_id: parseInt(form.table_id.value),
                  seat_no: form.seat_no.value
                    ? parseInt(form.seat_no.value)
                    : null,
                }
              : null,
            order: {
              order_id: parseInt(form.order_id.value),
              order_date: new Date().toISOString(),
              order_type: form.order_type.value,
              no_table: form.table_id.value ? parseInt(form.table_id.value) : 0,
              note: form.note.value,
            },
            payment: {
              total: parseFloat(form.total.value),
              method: form.method.value,
            },
          };
          try {
            const res = await fetch(`${API_BASE}/FullOrderRequest`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            const data = await res.json();
            document.getElementById("orderMessage").textContent =
              data.message || "Order submitted!";
            form.reset();
            loadDashboard();
          } catch (err) {
            console.error(err);
            document.getElementById("orderMessage").textContent =
              "Error submitting order";
          }
        });

      window.onload = loadDashboard;
    </script>
  </body>
</html>
