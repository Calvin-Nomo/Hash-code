<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Details</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: #f4f5f7;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 1000px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2 {
        text-align: center;
        margin-bottom: 20px;
      }
      .order-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }
      .order-info div {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th,
      td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: left;
      }
      th {
        background: #f4f5f7;
      }
      img.product-img {
        width: 80px;
        height: 80px;
        border-radius: 8px;
      }
      .btn {
        padding: 10px 20px;
        background: #1a1a2e;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 10px;
      }
      .btn:hover {
        background: #0f3460;
      }
      .total-amount {
        text-align: right;
        font-size: 18px;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Order Details</h1>

      <div class="order-info">
        <div>
          <h2>Order Info</h2>
          <p><strong>Order ID:</strong> <span id="orderId">#1234</span></p>
          <p>
            <strong>Order Date:</strong> <span id="orderDate">2025-10-27</span>
          </p>
          <p>
            <strong>Order Time:</strong> <span id="orderTime">12:30 PM</span>
          </p>
          <p>
            <strong>Order Type:</strong> <span id="orderType">Dine-in</span>
          </p>
        </div>
        <div>
          <h2>Client Info</h2>
          <p><strong>Name:</strong> <span id="clientName">John Doe</span></p>
          <p>
            <strong>Phone:</strong>
            <span id="clientPhone">+237 123 456 789</span>
          </p>
          <p>
            <strong>Payment Method:</strong>
            <span id="paymentMethod">Cash</span>
          </p>
          <p>
            <strong>Payment Status:</strong>
            <span id="paymentStatus">Paid</span>
          </p>
        </div>
      </div>

      <h2>Ordered Items</h2>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Image</th>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Price (FCFA)</th>
            <th>Total (FCFA)</th>
          </tr>
        </thead>
        <tbody id="orderItemsTbody">
          <tr>
            <td colspan="6" style="text-align: center">Loading items...</td>
          </tr>
        </tbody>
      </table>

      <p class="total-amount">Total: <span id="totalAmount">0 FCFA</span></p>

      <div style="text-align: center">
        <button class="btn" onclick="printInvoice()">Print Invoice</button>
        <button class="btn" onclick="markCompleted()">Mark as Completed</button>
        <button class="btn" onclick="cancelOrder()">Cancel Order</button>
      </div>
    </div>

    <script>
      // Example: Fetch order from backend
      async function fetchOrder(orderId = 1234) {
        try {
          const res = await fetch(
            `http://127.0.0.1:8000/order/order/${orderId}`
          );
          if (!res.ok) throw new Error("Failed to fetch order");
          const order = await res.json();

          // Populate order info
          document.getElementById("orderId").innerText = order.Order_ID;
          document.getElementById("orderDate").innerText = new Date(
            order.Order_Date
          ).toLocaleDateString();
          document.getElementById("orderTime").innerText = new Date(
            order.Order_Date
          ).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
          document.getElementById("orderType").innerText = order.Order_Type;
          document.getElementById("clientName").innerText = order.Client_Name;
          document.getElementById("clientPhone").innerText = order.No_Telephone;
          document.getElementById("paymentMethod").innerText =
            order.Payment_Method;
          document.getElementById("paymentStatus").innerText =
            order.Payment_Status;

          // Populate items
          const tbody = document.getElementById("orderItemsTbody");
          tbody.innerHTML = "";
          let total = 0;
          order.items.forEach((item, index) => {
            const tr = document.createElement("tr");
            const itemTotal = item.Quantity * item.Price;
            total += itemTotal;
            tr.innerHTML = `
          <td>${index + 1}</td>
          <td><img src="${item.Image}" class="product-img"></td>
          <td>${item.Product_Name}</td>
          <td>${item.Quantity}</td>
          <td>${item.Price}</td>
          <td>${itemTotal}</td>
        `;
            tbody.appendChild(tr);
          });
          document.getElementById("totalAmount").innerText = total + " FCFA";
        } catch (err) {
          console.error(err);
          document.getElementById("orderItemsTbody").innerHTML =
            '<tr><td colspan="6" style="color:red;text-align:center;">Failed to load order items</td></tr>';
        }
      }

      function printInvoice() {
        window.print();
      }

      function markCompleted() {
        alert("Order marked as completed (mock function)");
      }

      function cancelOrder() {
        alert("Order canceled (mock function)");
      }

      // Call fetch order on page load
      fetchOrder();
    </script>
  </body>
</html>
