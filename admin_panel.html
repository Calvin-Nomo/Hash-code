
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Restaurant</title>
<!-- Include Chart.js CDN for revenue chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ---------------- Global Styles ---------------- */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { display:flex; height:100vh; background:#f0f2f5; overflow:hidden; }

/* ---------------- Sidebar ---------------- */
.sidebar {
    width: 250px;
    background: linear-gradient(180deg, #007bff, #00c6ff);
    color:#fff;
    display:flex;
    flex-direction:column;
    padding-top:20px;
    box-shadow: 2px 0 15px rgba(0,0,0,0.1);
}
.sidebar h2 { text-align:center; font-size:1.5em; margin-bottom:30px; font-weight:bold; text-shadow: 1px 1px rgba(0,0,0,0.3); }
.sidebar button {
    background:transparent; border:none; color:#fff; padding:15px 25px;
    text-align:left; font-size:1em; cursor:pointer; position:relative;
    transition: 0.3s; display:flex; align-items:center; gap:10px;
}
.sidebar button:hover, .sidebar button.active { background: rgba(255,255,255,0.15); padding-left:30px; box-shadow: inset 0 0 10px rgba(255,255,255,0.2);}
.sidebar button:focus { outline:none; background: rgba(255,255,255,0.25); }
.sidebar button::before {
    content:""; width:5px; height:100%; background:#fff; position:absolute; left:0; top:0;
    border-radius:0 4px 4px 0; opacity:0; transition:opacity 0.3s;
}
.sidebar button.active::before, .sidebar button:hover::before { opacity:1; }

/* ---------------- Main Content ---------------- */
.main-content { flex:1; padding:20px; overflow-y:auto; background:#f4f7fa; }
.section { display:none; }
.section.active { display:block; }

/* ---------------- Tables ---------------- */
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 8px 15px rgba(0,0,0,0.05); margin-bottom:20px; }
th, td { padding:12px; text-align:left; border-bottom:1px solid #eee; }
th { background:#f7f7f7; }
table tr:hover { background: rgba(0,123,255,0.05); transition:0.3s; }
table img { width:60px; height:60px; object-fit:cover; border-radius:8px; }

/* ---------------- Forms ---------------- */
input, button { margin-right:8px; padding:6px 10px; border-radius:6px; border:1px solid #ccc; }
button { border:none; background:#007bff; color:#fff; cursor:pointer; transition:0.3s; }
button:hover { background:#0056b3; }

/* ---------------- Dashboard Cards ---------------- */
.dashboard-cards { display:flex; gap:20px; margin-bottom:20px; }
.card { flex:1; background:#fff; border-radius:10px; padding:20px; text-align:center; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
.card h3 { margin-bottom:10px; }
</style>
</head>
<body>

<!-- ---------------- Sidebar ---------------- -->
<div class="sidebar">
<h2>Admin Panel</h2>
<button class="active" onclick="showSection('dashboard')">Dashboard</button>
<button onclick="showSection('client')">Clients</button>
<button onclick="showSection('product')">Products</button>
<button onclick="showSection('order')">Orders</button>
<button onclick="showSection('orderItems')">Order Items</button>
<button onclick="showSection('reservation')">Reservations</button>
<button onclick="showSection('payment')">Payments</button>
<button onclick="showSection('system')">System Settings</button>
<button onclick="logout()">Logout</button>
</div>

<!-- ---------------- Main Content ---------------- -->
<div class="main-content">

<!-- ---------------- Dashboard Section ---------------- -->
<div id="dashboard" class="section active">
  <h1>Dashboard</h1>

  <!-- Dashboard cards -->
  <div class="dashboard-cards">
    <div class="card">
      <h3>Total Orders</h3>
      <p id="total-orders">0</p>
    </div>
    <div class="card">
      <h3>Total Revenue</h3>
      <p id="total-revenue">0 FCFA</p>
    </div>
    <div class="card">
      <h3>Total Reservations</h3>
      <p id="total-reservations">0</p>
    </div>
  </div>

  <!-- Revenue chart -->
  <div style="margin-bottom:20px;">
    <label for="revenueFilter">Filter:</label>
    <select id="revenueFilter" onchange="updateRevenueChart()">
      <option value="day">Per Day</option>
      <option value="month">Per Month</option>
      <option value="year">Per Year</option>
    </select>
    <canvas id="revenueChart" height="150"></canvas>
  </div>

  <!-- Most sold products table -->
  <h3>Most Sold Products</h3>
  <table>
    <thead><tr><th>Product Name</th><th>Total Quantity Sold</th></tr></thead>
    <tbody id="product-table"></tbody>
  </table>
</div>

<!-- ---------------- Clients Section ---------------- -->
<div id="client" class="section">
  <h1>Clients</h1>
  <div class="add-client-form" style="margin-bottom:15px;">
    <input type="text" id="newClientName" placeholder="Name">
    <input type="text" id="newClientEmail" placeholder="Email">
    <input type="text" id="newClientPhone" placeholder="Phone">
    <button onclick="addClient()">Add Client</button>
  </div>
  <div class="search-bar">
    <input type="text" id="clientSearch" placeholder="Search clients..." oninput="filterClients()">
  </div>
  <table>
    <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Actions</th></tr></thead>
    <tbody id="clientTable"></tbody>
  </table>
</div>

<!-- ---------------- Products Section ---------------- -->
<div id="product" class="section">
  <h1>Products</h1>
  <div class="add-product-form" style="margin-bottom:15px;">
    <input type="text" id="newName" placeholder="Name">
    <input type="text" id="newCategory" placeholder="Category">
    <input type="number" id="newPrice" placeholder="Price">
    <input type="text" id="newDescription" placeholder="Description">
    <input type="text" id="newImage" placeholder="Image URL">
    <button onclick="addProduct()">Add Product</button>
  </div>
  <div class="search-bar">
    <input type="text" id="productSearch" placeholder="Search products..." oninput="filterProducts()">
  </div>
  <table>
    <thead><tr><th>ID</th><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Description</th><th>Actions</th></tr></thead>
    <tbody id="productTable"></tbody>
  </table>
</div>

<!-- ---------------- Orders Section ---------------- -->
<div id="order" class="section">
  <h1>Orders</h1>
  <div class="add-order-form" style="margin-bottom:15px;">
    <input type="text" id="newOrderType" placeholder="Order Type">
    <input type="number" id="newOrderTable" placeholder="Table No">
    <input type="text" id="newOrderNote" placeholder="Note">
    <button onclick="addOrder()">Add Order</button>
  </div>
  <table>
    <thead><tr>
      <th>ID</th><th>Type</th><th>Table</th><th>Note</th><th>Date</th><th>Actions</th>
    </tr></thead>
    <tbody id="orderTable"></tbody>
  </table>
</div>

<!-- ---------------- Order Items Section ---------------- -->
<div id="orderItems" class="section">
  <h1>Order Items</h1>
  <div class="add-order-item-form" style="margin-bottom:15px;">
    <input type="number" id="newItemOrderID" placeholder="Order ID">
    <input type="number" id="newItemProductID" placeholder="Product ID">
    <input type="number" id="newItemQuantity" placeholder="Quantity">
    <button onclick="addOrderItem()">Add Item</button>
  </div>
  <table>
    <thead><tr>
      <th>Order ID</th><th>Product ID</th><th>Quantity</th><th>Actions</th>
    </tr></thead>
    <tbody id="orderItemsTable"></tbody>
  </table>
</div>

<!-- ---------------- Reservations Section ---------------- -->
<div id="reservation" class="section">
  <h1>Reservations</h1>
  <div class="add-reservation-form" style="margin-bottom:15px;">
    <input type="text" id="newResClient" placeholder="Client Name">
    <input type="number" id="newResTable" placeholder="Table No">
    <input type="datetime-local" id="newResDate">
    <button onclick="addReservation()">Add Reservation</button>
  </div>
  <table>
    <thead><tr>
      <th>ID</th><th>Client</th><th>Table</th><th>Date</th><th>Actions</th>
    </tr></thead>
    <tbody id="reservationTable"></tbody>
  </table>
</div>

<!-- ---------------- Payments Section ---------------- -->
<div id="payment" class="section">
  <h1>Payments</h1>
  <div class="add-payment-form" style="margin-bottom:15px;">
    <input type="number" id="newPaymentOrderID" placeholder="Order ID">
    <input type="number" id="newPaymentTotal" placeholder="Total">
    <input type="text" id="newPaymentMethod" placeholder="Method">
    <input type="text" id="newPaymentStatus" placeholder="Status">
    <input type="datetime-local" id="newPaymentDate">
    <button onclick="addPayment()">Add Payment</button>
  </div>
  <table>
    <thead><tr>
      <th>ID</th><th>Order ID</th><th>Total</th><th>Method</th><th>Status</th><th>Date</th><th>Actions</th>
    </tr></thead>
    <tbody id="paymentTable"></tbody>
  </table>
</div>

<!-- ---------------- System Settings ---------------- -->
<div id="system" class="section"><h1>System Settings</h1></div>

</div>

<script>
// ---------------- Sidebar navigation ----------------
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

function logout(){ alert("Logging out..."); }

// ---------------- Global data arrays ----------------
let clients=[], products=[], orders=[], orderItems=[], reservations=[], payments=[];
let revenueChartInstance = null;

// ---------------- Fetch all data ----------------
function fetchData(){
  fetchClients(); fetchProducts(); fetchOrders(); fetchOrderItems();
  fetchReservations(); fetchPayments();
}

/* ---------- Clients ---------- */
function fetchClients(){
  fetch("http://127.0.0.1:8000/client/get_all_clients")
    .then(r=>r.json()).then(d=>{ clients=d; renderClients(); });
}
function renderClients(){
  const tbody=document.getElementById('clientTable'); tbody.innerHTML="";
  clients.forEach(c=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td>${c.Client_ID}</td><td>${c.Name}</td><td>${c.Email}</td><td>${c.Phone}</td>
      <td><button onclick="editClient(${c.Client_ID})">Edit</button>
      <button onclick="deleteClient(${c.Client_ID})">Delete</button></td>`;
    tbody.appendChild(row);
  });
}
function filterClients(){ const q=document.getElementById('clientSearch').value.toLowerCase();
  const tbody=document.getElementById('clientTable'); tbody.innerHTML="";
  clients.filter(c=>c.Name.toLowerCase().includes(q)||c.Email.toLowerCase().includes(q)||c.Phone.includes(q))
  .forEach(c=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${c.Client_ID}</td><td>${c.Name}</td><td>${c.Email}</td><td>${c.Phone}</td><td><button onclick="editClient(${c.Client_ID})">Edit</button><button onclick="deleteClient(${c.Client_ID})">Delete</button></td>`; tbody.appendChild(row); });
}
function addClient(){ const newC={Name:document.getElementById('newClientName').value,Email:document.getElementById('newClientEmail').value,Phone:document.getElementById('newClientPhone').value};
  fetch("http://127.0.0.1:8000/client/create_client",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(newC)})
  .then(res=>res.json()).then(()=>fetchClients());
}
function editClient(id){ const c=clients.find(c=>c.Client_ID===id);
  const newName=prompt("Name",c.Name)||c.Name;
  const newEmail=prompt("Email",c.Email)||c.Email;
  const newPhone=prompt("Phone",c.Phone)||c.Phone;
  fetch(`http://127.0.0.1:8000/client/update_client/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Name:newName,Email:newEmail,Phone:newPhone})})
  .then(res=>res.json()).then(()=>fetchClients());
}
function deleteClient(id){ if(!confirm("Delete client?")) return;
  fetch(`http://127.0.0.1:8000/client/delete_client/${id}`,{method:"DELETE"}).then(res=>res.json()).then(()=>fetchClients()); }

/* ---------- Products ---------- */
function fetchProducts(){ fetch("http://127.0.0.1:8000/product/product/Product").then(r=>r.json()).then(d=>{ products=d; renderProducts(); }); }
function renderProducts(){ const tbody=document.getElementById('productTable'); tbody.innerHTML="";
  products.forEach(p=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${p.No_Product||''}</td><td><img src="${p.Image_Link||'https://via.placeholder.com/60'}"></td><td>${p.Product_Name}</td><td>${p.Category}</td><td>${p.Unit_Price} FCFA</td><td>${p.Product_Description}</td><td><button onclick="editProduct(${p.No_Product})">Edit</button><button onclick="deleteProduct(${p.No_Product})">Delete</button></td>`; tbody.appendChild(row); }); }
function filterProducts(){ const q=document.getElementById('productSearch').value.toLowerCase(); const tbody=document.getElementById('productTable'); tbody.innerHTML="";
  products.filter(p=>p.Product_Name.toLowerCase().includes(q)||p.Category.toLowerCase().includes(q))
  .forEach(p=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${p.No_Product||''}</td><td><img src="${p.Image_Link||'https://via.placeholder.com/60'}"></td><td>${p.Product_Name}</td><td>${p.Category}</td><td>${p.Unit_Price} FCFA</td><td>${p.Product_Description}</td><td><button onclick="editProduct(${p.No_Product})">Edit</button><button onclick="deleteProduct(${p.No_Product})">Delete</button></td>`; tbody.appendChild(row); }); }
function addProduct(){ const newP={Product_Name:document.getElementById('newName').value,Category:document.getElementById('newCategory').value, Unit_Price:parseFloat(document.getElementById('newPrice').value),Product_Description:document.getElementById('newDescription').value, Image_Link:document.getElementById('newImage').value};
  fetch("http://127.0.0.1:8000/product/product/create_product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(newP)}).then(res=>res.json()).then(()=>fetchProducts()); }
function editProduct(id){ const p=products.find(p=>p.No_Product===id); const newName=prompt("Name",p.Product_Name)||p.Product_Name; const newCat=prompt("Category",p.Category)||p.Category; const newPrice=prompt("Price",p.Unit_Price)||p.Unit_Price; const newDesc=prompt("Description",p.Product_Description)||p.Product_Description; const newImg=prompt("Image URL",p.Image_Link)||p.Image_Link;
  fetch(`http://127.0.0.1:8000/product/product/update_product/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Product_Name:newName,Category:newCat,Unit_Price:parseFloat(newPrice),Product_Description:newDesc,Image_Link:newImg})}).then(res=>res.json()).then(()=>fetchProducts()); }
function deleteProduct(id){ if(!confirm("Delete product?")) return; fetch(`http://127.0.0.1:8000/product/product/delete_product/${id}`,{method:"DELETE"}).then(res=>res.json()).then(()=>fetchProducts()); }

/* ---------- Orders ---------- */
function fetchOrders(){ fetch("http://127.0.0.1:8000/order/order/get_all_orders").then(r=>r.json()).then(d=>{ orders=d; renderOrders(); updateDashboardCards(); updateRevenueChart(); updateMostSoldProducts(); }); }
function renderOrders(){ const tbody=document.getElementById('orderTable'); tbody.innerHTML="";
  orders.forEach(o=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${o.Order_ID}</td><td>${o.Order_Type}</td><td>${o.No_Table}</td><td>${o.Note}</td><td>${new Date(o.Order_Date).toLocaleString()}</td><td><button onclick="editOrder(${o.Order_ID})">Edit</button><button onclick="deleteOrder(${o.Order_ID})">Delete</button></td>`; tbody.appendChild(row); }); }
function addOrder(){ const newOrder={Order_Type:document.getElementById('newOrderType').value, No_Table:parseInt(document.getElementById('newOrderTable').value), Note:document.getElementById('newOrderNote').value};
  fetch("http://127.0.0.1:8000/order/order/create_order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(newOrder)}).then(()=>fetchOrders()); }
function editOrder(id){ const o=orders.find(o=>o.Order_ID===id); const newType=prompt("Type",o.Order_Type)||o.Order_Type; const newTable=prompt("Table",o.No_Table)||o.No_Table; const newNote=prompt("Note",o.Note)||o.Note;
  fetch(`http://127.0.0.1:8000/order/order/update_order/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Order_Type:newType,No_Table:parseInt(newTable),Note:newNote})}).then(()=>fetchOrders()); }
function deleteOrder(id){ if(!confirm("Delete order?")) return; fetch(`http://127.0.0.1:8000/order/order/delete_order/${id}`,{method:"DELETE"}).then(()=>fetchOrders()); }

/* ---------- Order Items ---------- */
function fetchOrderItems(){ fetch("http://127.0.0.1:8000/order/order_items").then(r=>r.json()).then(d=>{ orderItems=d; renderOrderItems(); updateDashboardCards(); updateMostSoldProducts(); }); }
function renderOrderItems(){ const tbody=document.getElementById('orderItemsTable'); tbody.innerHTML="";
  orderItems.forEach(oi=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${oi.Order_ID}</td><td>${oi.No_Product}</td><td>${oi.Quantity}</td><td><button onclick="editOrderItem(${oi.Order_ID},${oi.No_Product})">Edit</button><button onclick="deleteOrderItem(${oi.Order_ID},${oi.No_Product})">Delete</button></td>`; tbody.appendChild(row); }); }
function addOrderItem(){ const newItem={Order_ID:parseInt(document.getElementById('newItemOrderID').value),No_Product:parseInt(document.getElementById('newItemProductID').value), Quantity:parseInt(document.getElementById('newItemQuantity').value)};
  fetch("http://127.0.0.1:8000/order/order_items/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(newItem)}).then(()=>fetchOrderItems()); }
function editOrderItem(orderId,productId){ const oi=orderItems.find(oi=>oi.Order_ID===orderId && oi.No_Product===productId); const newQty=prompt("Quantity",oi.Quantity)||oi.Quantity;
  fetch(`http://127.0.0.1:8000/order/order_items/update/${orderId}/${productId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Quantity:parseInt(newQty)})}).then(()=>fetchOrderItems()); }
function deleteOrderItem(orderId,productId){ if(!confirm("Delete order item?")) return; fetch(`http://127.0.0.1:8000/order/order_items/delete/${orderId}/${productId}`,{method:"DELETE"}).then(()=>fetchOrderItems()); }

/* ---------- Reservations ---------- */
function fetchReservations(){ fetch("http://127.0.0.1:8000/reservation/get_all").then(r=>r.json()).then(d=>{ reservations=d; renderReservations(); updateDashboardCards(); }); }
function renderReservations(){ const tbody=document.getElementById('reservationTable'); tbody.innerHTML="";
  reservations.forEach(r=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${r.No_Reservation}</td><td>${r.Client_Name||''}</td><td>${r.No_Table}</td><td>${new Date(r.Reservation_Date).toLocaleString()}</td><td><button onclick="editReservation(${r.No_Reservation})">Edit</button><button onclick="deleteReservation(${r.No_Reservation})">Delete</button></td>`; tbody.appendChild(row); }); }
function addReservation(){ const newRes={Client_Name:document.getElementById('newResClient').value, No_Table:parseInt(document.getElementById('newResTable').value), Reservation_Date:document.getElementById('newResDate').value};
  fetch("http://127.0.0.1:8000/reservation/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(newRes)}).then(()=>fetchReservations()); }
function editReservation(id){ const r=reservations.find(r=>r.No_Reservation===id); const newClient=prompt("Client",r.Client_Name)||r.Client_Name; const newTable=prompt("Table",r.No_Table)||r.No_Table; const newDate=prompt("Date",r.Reservation_Date)||r.Reservation_Date;
  fetch(`http://127.0.0.1:8000/reservation/update/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Client_Name:newClient,No_Table:parseInt(newTable),Reservation_Date:newDate})}).then(()=>fetchReservations()); }
function deleteReservation(id){ if(!confirm("Delete reservation?")) return; fetch(`http://127.0.0.1:8000/reservation/delete/${id}`,{method:"DELETE"}).then(()=>fetchReservations()); }

/* ---------- Payments ---------- */
function fetchPayments(){ fetch("http://127.0.0.1:8000/payment/payment/get_all_payments").then(r=>r.json()).then(d=>{ payments=d; renderPayments(); updateDashboardCards(); updateRevenueChart(); }); }
function renderPayments(){ const tbody=document.getElementById('paymentTable'); tbody.innerHTML="";
  payments.forEach(p=>{ const row=document.createElement('tr'); row.innerHTML=`<td>${p.Payment_ID}</td><td>${p.Order_ID}</td><td>${p.Total_Amount} FCFA</td><td>${p.Payment_Method}</td><td>${p.Payment_Status}</td><td>${new Date(p.Payment_Date).toLocaleString()}</td><td><button onclick="editPayment(${p.Payment_ID})">Edit</button><button onclick="deletePayment(${p.Payment_ID})">Delete</button></td>`; tbody.appendChild(row); }); }
function addPayment(){ const newPay={Order_ID:parseInt(document.getElementById('newPaymentOrderID').value), Total_Amount:parseFloat(document.getElementById('newPaymentTotal').value), Payment_Method:document.getElementById('newPaymentMethod').value, Payment_Status:document.getElementById('newPaymentStatus').value, Payment_Date:document.getElementById('newPaymentDate').value};
  fetch("http://127.0.0.1:8000/payment/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(newPay)}).then(()=>fetchPayments()); }
function editPayment(id){ const p=payments.find(p=>p.Payment_ID===id); const newOrder=prompt("Order ID",p.Order_ID)||p.Order_ID; const newTotal=prompt("Total",p.Total_Amount)||p.Total_Amount; const newMethod=prompt("Method",p.Payment_Method)||p.Payment_Method; const newStatus=prompt("Status",p.Payment_Status)||p.Payment_Status; const newDate=prompt("Date",p.Payment_Date)||p.Payment_Date;
  fetch(`http://127.0.0.1:8000/payment/update/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Order_ID:parseInt(newOrder),Total_Amount:parseFloat(newTotal),Payment_Method:newMethod,Payment_Status:newStatus,Payment_Date:newDate})}).then(()=>fetchPayments()); }
function deletePayment(id){ if(!confirm("Delete payment?")) return; fetch(`http://127.0.0.1:8000/payment/delete/${id}`,{method:"DELETE"}).then(()=>fetchPayments()); }

/* ---------- Dashboard Cards & Revenue ---------- */
function updateDashboardCards(){
  document.getElementById('total-orders').innerText = orders.length;
  document.getElementById('total-revenue').innerText = payments.reduce((sum,p)=>sum+p.Total_Amount,0) + " FCFA";
  document.getElementById('total-reservations').innerText = reservations.length;
}

function updateRevenueChart(){
  const filter = document.getElementById('revenueFilter').value;
  let labels=[], data=[];
  const map = {};
  payments.forEach(p=>{
    let key;
    const d = new Date(p.Payment_Date);
    if(filter==='day'){ key = d.toLocaleDateString(); }
    else if(filter==='month'){ key = d.getMonth()+1 + "/" + d.getFullYear(); }
    else{ key = d.getFullYear(); }
    map[key] = (map[key]||0) + p.Total_Amount;
  });
  for(const k in map){ labels.push(k); data.push(map[k]); }
  
  if(revenueChartInstance) revenueChartInstance.destroy();
  const ctx = document.getElementById('revenueChart').getContext('2d');
  revenueChartInstance = new Chart(ctx,{ type:'bar', data:{labels, datasets:[{label:'Revenue', data, backgroundColor:'#007bff'}] }, options:{} });
}

/* ---------- Most Sold Products ---------- */
function updateMostSoldProducts(){
  const productMap={};
  orderItems.forEach(oi=>{
    const p = products.find(p=>p.No_Product===oi.No_Product);
    if(p) productMap[p.Product_Name] = (productMap[p.Product_Name]||0)+oi.Quantity;
  });
  const tbody=document.getElementById('product-table'); tbody.innerHTML="";
  Object.keys(productMap).sort((a,b)=>productMap[b]-productMap[a]).forEach(name=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td>${name}</td><td>${productMap[name]}</td>`;
    tbody.appendChild(row);
  });
}

// ---------------- Initialize ----------------
fetchData();
</script>

</body>
</html>
