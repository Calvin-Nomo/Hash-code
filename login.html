<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login</title>
  <!-- Montserrat / Poppins Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet"
  />
  <!-- Boxicons -->
  <link
    href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
    rel="stylesheet"
  />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="./frontend/css/style.css" />
</head>
<body>
  <div class="wrapper">
    <div class="form-header">
      <div class="titles">
        <div class="title-login">Login</div>
      </div>
    </div>

    <!-- Login Form -->
    <form class="login-form" autocomplete="off">
      <div class="input-box">
        <input type="email" class="input-field" id="log-email" required />
        <label for="log-email" class="label">Email</label>
        <i class="bx bx-envelope icon"></i>
      </div>

      <div class="input-box">
        <input type="password" class="input-field" id="log-pass" required />
        <label for="log-pass" class="label">Password</label>
        <i class="bx bx-lock-alt icon"></i>
      </div>

      <div class="form-cols">
        <div class="col-1"></div>
        <div class="col-2"></div>
        <a href="#">Forgot Password?</a>
      </div>

      <div class="input-box">
        <button class="btn-submit" id="SignInBtn">
          Sign In
          <i class="bx bx-log-in"></i>
        </button>
      </div>
    </form>
  </div>

  <script>
    const signInBtn = document.getElementById("SignInBtn");

    signInBtn.addEventListener("click", async (e) => {
      e.preventDefault();

      const Email = document.getElementById("log-email").value;
      const Password = document.getElementById("log-pass").value;

      const formData = new FormData();
      formData.append("username", Email);  // ⚠️ match backend expected key
      formData.append("password", Password);

      try {
        const response = await fetch("http://127.0.0.1:8000/login", {
          method: "POST",
          body: formData,
          credentials: "include", // for JWT cookies if used
        });

        const data = await response.json();
        console.log("Login response:", data);

        if (response.ok) {
          localStorage.setItem('user_id', data.user_id);
          alert("Login successful!");
          
          if (data.role === "admin") {
            window.location.href = "admin.html";
          } else {
            window.location.href = "dashboard.html"; // redirect for other roles
          }
        } else {
          alert(data.detail ? data.detail[0].msg : "Login error");
        }
      } catch (error) {
        console.error("Login error:", error);
        alert("An error occurred. Check console for details.");
      }
    });
  </script>
</body>
</html>
